services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      - ./frontend:/app  # Syncs your local code with the container
      - /app/node_modules  # Prevents overwriting node_modules in the container
    ports:
      - '3000:3000'  # Exposes the React development server port
    environment:
      - CHOKIDAR_USEPOLLING=true  # Ensures hot reloading works in Docker
    networks:
      - frontend

  # frontend:
  #   image: nginx:alpine
  #   build:
  #     context: ./frontend
  #     dockerfile: Dockerfile
  #   develop:  
  #     watch:
  #       - action: sync
  #         path: ./frontend
  #         target: ./frontend/build
  #         ignore:
  #           - node_modules/
  #       - action: rebuild
  #         path: ./frontend/package.json
  #   volumes:
  #     - ./frontend/build:/usr/share/nginx/html
  #     - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf
  #   ports:
  #     - '80:80'
  #   networks:
  #     - frontend
  #   depends_on:
  #     - backend

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - '5000:5000'
    networks:
      - backend
      - frontend
    environment:
      - REDIS_SERVER_IP=redis
    depends_on:
      - redis

  redis:
    image: redis:alpine
    ports:
      - '6379:6379'
    networks:
      - backend

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge